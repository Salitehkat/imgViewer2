<!DOCTYPE html>
<html>
	<head>
		<title>imgViewer2 Plugin - note display using Leaflet plugins</title>
		
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" />
		<script type="text/javascript" src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
		<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
		<script type="text/javascript" src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
		<script type="text/javascript" src="lib/imgViewer2.js"></script>
		
		<script src="https://unpkg.com/leaflet-responsive-popup@0.2.0/leaflet.responsive.popup.js"></script>
		<link rel="stylesheet" href="https://unpkg.com/leaflet-responsive-popup@0.2.0/leaflet.responsive.popup.css" />

		<link rel="stylesheet" href="lib/leaflet-beautify-marker-icon.css">
		<script src="lib/leaflet-beautify-marker-icon.js"></script>
		
		<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
        <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />

		<link rel="stylesheet" href="lib/Control.MiniMap.min.css">
		<script src="lib/Control.MiniMap.min.js"></script>

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes" />
	</head>
	<body>
		<table cellspacing="0" cellpadding="0" border="0" style="width: 100%; min-width: 320px;">
			<tr>
			<td style="padding: 10px">
				<h1 align="center">imgViewer2 Plugin - Leaflet Plugin Farm</h1>
				<div id="imgv" style="margin: auto; width:80%; height: 600px;">
				</div>
				<p style="margin:10px 5% 10px 5%;text-align: justify;">
				This example uses:
				</p>
				<ul style="margin:10px 5% 10px 5%;text-align: justify;">
                    <li>
                        The <a href="https://github.com/marslan390/BeautifyMarker" target="blank">BeautifyMarker</a> plugin for marker display;
                    </li>
                    <li>
                        The <a href="https://github.com/yafred/leaflet-responsive-popup" target="blank">Leaflet Responsive Popup</a> plugin to replace the normal Leaflet popup to get popups that behave nicely for markers close to the edges of the view;
                    </li>
                    <li>
                        The <a href="https://github.com/Leaflet/Leaflet.fullscreen" target="blank">Leaflet.fullscreen</a> plugin to display the widget fullscreen.
                    </li>
                    <li>
                        The <a href="https://github.com/Norkart/Leaflet-MiniMap" target="blank">Leaflet-MiniMap</a> plugin to display an overview of the image.
                    </li>
                </ul>
			</td>
			</tr>
		</table>

<script type="text/javascript">
;(function($) {
	$.widget("wgm.imgNotes2", $.wgm.imgViewer2, {
		options: {
/*
 *	Defaault action for addNote callback
*/
			addNote: function(data) {
				var map = this.map,
					loc = this.relposToLatLng(data.x, data.y);
				var popup = L.responsivePopup({ hasTip: true, autoPan: false}).setContent(data.note);
				var icon = L.BeautifyIcon.icon({icon: 'arrow-down',
												borderColor: '#FFF607',
												textColor: '#FFF607',
												backgroundColor: 'transparent'
				});
				
				L.marker(loc, {icon: icon}).addTo(map).bindPopup(popup);
			}
			
		},
		
/*
 *	Add notes from a javascript array
 */
		import: function(notes) {
			if (this.ready) {
				var self = this;
				$.each(notes, function() {
					self.options.addNote.call(self, this);
				});	
			}
		}
	});
	$(document).ready( function() {
		var $img = $("#imgv").imgNotes2( {
                        imgURL: "images/test_image.jpg",
                        constraint: 'height',
						onReady: function() {
							var notes = [	{x: "0.5", y:"0.5", note:"AFL Grand Final Trophy"}, 
											{x: "0.322", y:"0.269", note: '\
											<center><b>Brisbane Lions Flag</b><br/>\
											<img src="http://www.lions.com.au/static-resources/themes/brisbane/images/logo-brisbane.png"/></center>\
											<a href="http://www.lions.com.au/" target="blank">The Brisbane Lions</a> \
											is an <a href="http://en.wikipedia.org/wiki/Australian_rules_football" target="blank">Australian rules football club.</a>'
											},
											{x: "0.824", y: "0.593", note: "Fluffy microphone"}];
							this.import(notes);
							
							this.map.addControl(new L.Control.Fullscreen());
							
							var img2 = new L.imageOverlay(this.options.imgURL, this.bounds);
							var minimap_height = 100;
							var minimap_width = minimap_height* this.imgwidth/this.imgheight;
							var minimap = new L.Control.MiniMap(img2, {centerFixed: L.latLng(this.imgheight/2,this.imgwidth/2), height: minimap_height, width: minimap_width, mapOptions:{crs:L.CRS.Simple, zoomSnap: 0}}).addTo(this.map);
							minimap._miniMap.setMaxBounds(this.bounds);
							minimap._miniMap.setMinZoom(-2000);
							
							var zoom = minimap._miniMap.getBoundsZoom(this.bounds);
							minimap.options.zoomLevelFixed = zoom;
							minimap._miniMap.setZoom(zoom);
							
							
							
						}
		});
	});
})(jQuery);
</script>
		</body>
</html>
